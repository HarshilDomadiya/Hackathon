<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login / Register</title>
    <link rel="stylesheet" href="./assets/css/styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
  </head>
  <body>
    <!--=============== HEADER ===============-->
    <header class="header">
        <div class="header__top">
          <div class="header__container container">
            <div class="header__contact">
              <span><a href="tel:+91 8733978801" style="color: black;">+91 8733978801</a></span>
              <span>Our location</span>
            </div>
            <p class="header__alert-news">
              Super Values Deals - Save more coupons
            </p>
            <a href="login-register.html" class="header__top-action">
              Log In / Sign Up
            </a>
          </div>
        </div>
  
        <nav class="nav container">
          <a href="index.html" class="nav__logo">
            <img
              class="nav__logo-img"
              src="assets/img/logo.svg"
              alt="website logo"
            />
          </a>
          <div class="nav__menu" id="nav-menu">
            <ul class="nav__list">
              <li class="nav__item">
                <a href="index.html" class="nav__link">Home</a>
              </li>
              <li class="nav__item">
                <a href="shop.html" class="nav__link">Shop</a>
              </li>
              <li class="nav__item">
                <a href="accounts.html" class="nav__link">My Account</a>
              </li>
              <li class="nav__item">
                <a href="compare.html" class="nav__link">Compare</a>
              </li>
              <li class="nav__item">
                <a href="login-register.html" class="nav__link">Login</a>
              </li>
            </ul>
            <div class="header__search">
              <input
                type="text"
                placeholder="Search For Items..."
                class="form__input"
              />
              <button class="search__btn">
                <img src="assets/img/search.png" alt="search icon" />
              </button>
            </div>
          </div>
          <div class="header__user-actions">
            <a href="wishlist.html" class="header__action-btn" title="Wishlist">
              <img src="assets/img/icon-heart.svg" alt="" />
              <span class="count">0</span>
            </a>
            <a href="cart.html" class="header__action-btn" title="Cart">
              <img src="assets/img/icon-cart.svg" alt="" />
              <span class="count">0</span>
            </a>
          </div>
        </nav>
      </header>

    <!--=============== MAIN ===============-->
    <main class="main">
      <!--=============== BREADCRUMB ===============-->
      <section class="breadcrumb">
        <ul class="breadcrumb__list flex container">
          <li><a href="index.html" class="breadcrumb__link">Home</a></li>
          <li><span class="breadcrumb__link">></span></li>
          <li><span class="breadcrumb__link">Login / Register</span></li>
        </ul>
      </section>

      <!--=============== LOGIN-REGISTER ===============-->
      <section class="login-register section--lg">
        <div class="login-register__container container grid">
          <div class="login">
            <h3 class="section__title">Login</h3>
            <form id="loginForm" class="form grid">
              <input
                type="email"
                placeholder="Your Email"
                class="form__input"
                id="loginEmail"
                required
              />
              <input
                type="password"
                placeholder="Your Password"
                class="form__input"
                id="loginPassword"
                required
              />
              <div class="form__btn">
                <button type="submit" class="btn">Login</button>
              </div>
            </form>
          </div>
          <div class="register">
            <h3 class="section__title">Create an Account</h3>
            <form id="registerForm" class="form grid">
              <input
                type="text"
                placeholder="Username"
                class="form__input"
                id="registerUsername"
                required
              />
              <input
                type="email"
                placeholder="Your Email"
                class="form__input"
                id="registerEmail"
                required
              />
              <input
                type="password"
                placeholder="Your Password"
                class="form__input"
                id="registerPassword"
                required
              />
              <input
                type="password"
                placeholder="Confirm Password"
                class="form__input"
                id="confirmPassword"
                required
              />
              <div class="form__btn">
                <button type="submit" class="btn">Submit & Register</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!--=============== USER COUNT ===============-->
      <section class="user-count section">
        <div class="container">
          <h3 class="section__title">Registered Users: <span id="userCount">0</span></h3>
        </div>
      </section>

      <!--=============== NEWSLETTER ===============-->
      <section class="newsletter section">
        <div class="newsletter__container container grid">
          <h3 class="newsletter__title flex">
            <img
              src="./assets/img/icon-email.svg"
              alt=""
              class="newsletter__icon"
            />
            Sign in to Newsletter
          </h3>
          <p class="newsletter__description">
            ...and receive $25 coupon for first shopping.
          </p>
          <form action="" class="newsletter__form">
            <input
              type="text"
              placeholder="Enter Your Email"
              class="newsletter__input"
            />
            <button type="submit" class="newsletter__btn">Subscribe</button>
          </form>
        </div>
      </section>
    </main>

    <!--=============== FOOTER ===============-->
    <footer class="footer container">
        <div class="footer__container grid">
          <div class="footer__content">
            <a href="index.html" class="footer__logo">
              <img src="./assets/img/logo.svg" alt="" class="footer__logo-img" />
            </a>
            <h4 class="footer__subtitle">Contact</h4>
            <p class="footer__description">
              <span>Address:</span> 13 Tlemcen Road, Street 32, Beb-Wahren
            </p>
            <p class="footer__description">
              <span>Phone:</span> +01 2222 365 /(+91) 01 2345 6789
            </p>
            <p class="footer__description">
              <span>Hours:</span> 10:00 - 18:00, Mon - Sat
            </p>
            <div class="footer__social">
              <h4 class="footer__subtitle">Follow Me</h4>
              <div class="footer__links flex">
                <a href="#">
                  <img
                    src="./assets/img/icon-facebook.svg"
                    alt=""
                    class="footer__social-icon"
                  />
                </a>
                <a href="#">
                  <img
                    src="./assets/img/icon-twitter.svg"
                    alt=""
                    class="footer__social-icon"
                  />
                </a>
                <a href="#">
                  <img
                    src="./assets/img/icon-instagram.svg"
                    alt=""
                    class="footer__social-icon"
                  />
                </a>
                <a href="#">
                  <img
                    src="./assets/img/icon-pinterest.svg"
                    alt=""
                    class="footer__social-icon"
                  />
                </a>
                <a href="#">
                  <img
                    src="./assets/img/icon-youtube.svg"
                    alt=""
                    class="footer__social-icon"
                  />
                </a>
              </div>
            </div>
          </div>
          <div class="footer__content">
            <h3 class="footer__title">Address</h3>
            <ul class="footer__links">
              <li><a href="#" class="footer__link">About Us</a></li>
              <li><a href="#" class="footer__link">Delivery Information</a></li>
              <li><a href="#" class="footer__link">Privacy Policy</a></li>
              <li><a href="#" class="footer__link">Terms & Conditions</a></li>
              <li><a href="#" class="footer__link">Contact Us</a></li>
              <li><a href="#" class="footer__link">Support Center</a></li>
            </ul>
          </div>
          <div class="footer__content">
            <h3 class="footer__title">My Account</h3>
            <ul class="footer__links">
              <li><a href="#" class="footer__link">Sign In</a></li>
              <li><a href="#" class="footer__link">View Cart</a></li>
              <li><a href="#" class="footer__link">My Wishlist</a></li>
              <li><a href="#" class="footer__link">Track My Order</a></li>
              <li><a href="#" class="footer__link">Help</a></li>
              <li><a href="#" class="footer__link">Order</a></li>
            </ul>
          </div>
          <div class="footer__content">
            <h3 class="footer__title">Secured Payed Gateways</h3>
            <img
              src="./assets/img/payment-method.png"
              alt=""
              class="payment__img"
            />
          </div>
        </div>
        <div class="footer__bottom">
          <p class="copyright">&copy; 2024 ShopWare Tech. All right reserved</p>
          <span class="designer">Designer by Crypticalcoder</span>
        </div>
      </footer>

    <!--=============== MAIN JS ===============-->
    <script src="assets/js/main.js"></script>

    <!--=============== LOGIN-REGISTER JS ===============-->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const userCountElement = document.getElementById('userCount');

        function updateUserCount() {
          fetch('/api/user-count.php')
            .then(response => response.json())
            .then(data => {
              userCountElement.textContent = data.count;
            })
            .catch(error => console.error('Error:', error));
        }

        updateUserCount();

        loginForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const email = document.getElementById('loginEmail').value;
          const password = document.getElementById('loginPassword').value;
          
          fetch('/api/login.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password }),
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Login successful!');
              updateUIAfterLogin(email);
            } else {
              alert('Invalid email or password. Please try again or register if you don\'t have an account.');
            }
          })
          .catch(error => console.error('Error:', error));
        });

        registerForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const username = document.getElementById('registerUsername').value;
          const email = document.getElementById('registerEmail').value;
          const password = document.getElementById('registerPassword').value;
          const confirmPassword = document.getElementById('confirmPassword').value;

          if (password !== confirmPassword) {
            alert('Passwords do not match. Please try again.');
            return;
          }

          fetch('/api/register.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, email, password }),
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Account created successfully! You can now log in.');
              registerForm.reset();
              updateUserCount();
            } else {
              alert(data.message || 'An error occurred during registration.');
            }
          })
          .catch(error => console.error('Error:', error));
        });

        function updateUIAfterLogin(email) {
          const headerTopAction = document.querySelector('.header__top-action');
          const navLoginLink = document.querySelector('.nav__link[href="login-register.html"]');
          
          if (headerTopAction) {
            headerTopAction.textContent = 'Logout';
            headerTopAction.href = '#';
            headerTopAction.onclick = logout;
          }
          
          if (navLoginLink) {
            navLoginLink.textContent = 'My Account';
            navLoginLink.href = 'accounts.html';
          }

          // Hide login/register forms
          document.querySelector('.login-register__container').style.display = 'none';
          
          // Show welcome message
          const welcomeMessage = document.createElement('div');
          welcomeMessage.className = 'welcome-message';
          welcomeMessage.innerHTML = `
            <h2>Welcome, ${email}!</h2>
            <p>You are now logged in.</p>
            <button class="btn" onclick="logout()">Logout</button>
          `;
          document.querySelector('.login-register').appendChild(welcomeMessage);
        }

        function logout() {
          fetch('/api/logout.php')
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                location.reload();
              } else {
                alert('Logout failed. Please try again.');
              }
            })
            .catch(error => console.error('Error:', error));
        }
      });
    </script>
  </body>
</html>